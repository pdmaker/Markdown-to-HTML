<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MD2HTML - Markdown Converter</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        :root {
            --background: #ffffff;
            --foreground: #020817;
            --muted: #f1f5f9;
            --muted-foreground: #64748b;
            --border: #e2e8f0;
            --input: #e2e8f0;
            --primary: #18181b;
            --primary-foreground: #ffffff;
            --ring: #18181b;
            --radius: 0.5rem;
            --navbar-bg: #ffffff;
            --navbar-border: #e2e8f0;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <a href="/" class="logo">MD2HTML</a>
            <div class="navbar-controls">
                <button class="theme-switch" onclick="toggleTheme()" aria-label="Toggle theme">
                    <span class="theme-icon">üåô</span>
                </button>
                <button class="lang-switch" onclick="toggleLanguage()">‰∏≠Êñá</button>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <div class="header">
            <h1 data-i18n="title">Markdown and HTML Converter</h1>
        </div>

        <div class="controls">
            <div class="mode-switch">
                <select id="convert-mode" onchange="switchMode()" aria-label="Conversion mode">
                    <option value="md2html" data-i18n="md2html">Markdown to HTML</option>
                    <option value="html2md" data-i18n="html2md">HTML to Markdown</option>
                </select>
            </div>
            <div class="citation-control" id="citation-control">
                <input type="checkbox" id="remove-citations" checked>
                <label for="remove-citations" data-i18n="removeCitations">Remove Citations</label>
            </div>
        </div>

        <div class="container">
            <div>
                <div class="input-label">
                    <h2 id="input-title" data-i18n="inputTitle">Markdown Input</h2>
                    <button onclick="clearInput()" data-i18n="clearInput">Clear Input</button>
                </div>
                <textarea id="input-area" data-i18n-placeholder="inputPlaceholder" placeholder="Enter your content here..."></textarea>
            </div>
            <div>
                <div class="output-label">
                    <h2 id="output-title" data-i18n="outputTitle">HTML Output</h2>
                    <button onclick="clearOutput()" data-i18n="clearOutput">Clear Output</button>
                </div>
                <div class="output" id="output-area"></div>
            </div>
        </div>
        <div class="buttons">
            <button onclick="convert()" data-i18n="convert">Convert</button>
            <button onclick="copyOutput()" data-i18n="copy">Copy Output</button>
        </div>
    </div>

    <script>
        const translations = {
            en: {
                title: 'Markdown and HTML Converter',
                md2html: 'Markdown to HTML',
                html2md: 'HTML to Markdown',
                removeCitations: 'Remove Citations',
                inputTitle: 'Markdown Input',
                outputTitle: 'HTML Output',
                clearInput: 'Clear Input',
                clearOutput: 'Clear Output',
                inputPlaceholder: 'Enter your content here...',
                convert: 'Convert',
                copy: 'Copy Output',
                copySuccess: 'Content copied to clipboard!',
                copyError: 'Copy failed, please copy manually'
            },
            zh: {
                title: 'Markdown Âíå HTML ÂèåÂêëËΩ¨Êç¢Â∑•ÂÖ∑',
                md2html: 'Markdown ËΩ¨ HTML',
                html2md: 'HTML ËΩ¨ Markdown',
                removeCitations: 'ÂéªÈô§ÂºïÊñá',
                inputTitle: 'Markdown ËæìÂÖ•',
                outputTitle: 'HTML ËæìÂá∫',
                clearInput: 'Ê∏ÖÁ©∫ËæìÂÖ•',
                clearOutput: 'Ê∏ÖÁ©∫ËæìÂá∫',
                inputPlaceholder: 'Âú®ËøôÈáåËæìÂÖ•ÂÜÖÂÆπ...',
                convert: 'ËΩ¨Êç¢',
                copy: 'Â§çÂà∂ËæìÂá∫',
                copySuccess: 'ÂÜÖÂÆπÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ',
                copyError: 'Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂'
            }
        };

        let currentLang = 'en';
        
        // Ê£ÄÊü•ÊòØÂê¶Âú®‰∏≠ÊñáË∑ØÂæÑ
        if (window.location.pathname.includes('/zh')) {
            currentLang = 'zh';
            document.documentElement.lang = 'zh-CN';
        }

        function updateThemeIcon() {
            const themeIcon = document.querySelector('.theme-icon');
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            themeIcon.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            updateThemeIcon();
        }

        // Ê£ÄÊü•Á≥ªÁªü‰∏ªÈ¢òÂÅèÂ•Ω
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.setAttribute('data-theme', 'dark');
            updateThemeIcon();
        }

        function updateLanguage() {
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                element.textContent = translations[currentLang][key];
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                element.placeholder = translations[currentLang][key];
            });

            document.querySelector('.lang-switch').textContent = currentLang === 'zh' ? 'English' : '‰∏≠Êñá';
            document.title = currentLang === 'zh' ? 'MD2HTML - Markdown ËΩ¨Êç¢Â∑•ÂÖ∑' : 'MD2HTML - Markdown Converter';
        }

        function toggleLanguage() {
            const newLang = currentLang === 'zh' ? 'en' : 'zh';
            const newPath = newLang === 'zh' ? '/zh' : '/';
            window.history.pushState({}, '', newPath);
            currentLang = newLang;
            document.documentElement.lang = currentLang === 'zh' ? 'zh-CN' : 'en';
            updateLanguage();
            switchMode();
        }

        const turndownService = new TurndownService();
        let currentMode = 'md2html';

        function removeCitations(text) {
            return text.replace(/^Citations:\s*(\n\[\d+\].*)*$/m, '').trim();
        }

        function switchMode() {
            currentMode = document.getElementById('convert-mode').value;
            const citationControl = document.getElementById('citation-control');
            const inputTitle = document.getElementById('input-title');
            const outputTitle = document.getElementById('output-title');
            const inputArea = document.getElementById('input-area');

            if (currentMode === 'md2html') {
                inputTitle.textContent = translations[currentLang].inputTitle;
                outputTitle.textContent = translations[currentLang].outputTitle;
                inputArea.placeholder = translations[currentLang].inputPlaceholder;
                citationControl.style.display = 'flex';
            } else {
                inputTitle.textContent = 'HTML ' + translations[currentLang].inputTitle;
                outputTitle.textContent = 'Markdown ' + translations[currentLang].outputTitle;
                inputArea.placeholder = translations[currentLang].inputPlaceholder;
                citationControl.style.display = 'none';
            }

            inputArea.value = '';
            document.getElementById('output-area').innerHTML = '';
        }

        function convert() {
            let input = document.getElementById('input-area').value;
            const outputArea = document.getElementById('output-area');
            const removeCitationsChecked = document.getElementById('remove-citations').checked;

            if (currentMode === 'md2html') {
                if (removeCitationsChecked) {
                    input = removeCitations(input);
                }
                const htmlOutput = marked.parse(input);
                const wrappedOutput = `<div class="content">\n  ${htmlOutput.trim().replace(/\n/g, '\n  ')}\n</div>`;
                outputArea.textContent = wrappedOutput;
            } else {
                outputArea.textContent = turndownService.turndown(input);
            }
        }

        function copyOutput() {
            const outputArea = document.getElementById('output-area');
            const content = outputArea.textContent;

            navigator.clipboard.writeText(content)
                .then(() => alert(translations[currentLang].copySuccess))
                .catch(err => alert(translations[currentLang].copyError));
        }

        function clearInput() {
            document.getElementById('input-area').value = '';
            convert();
        }

        function clearOutput() {
            document.getElementById('output-area').innerHTML = '';
        }

        document.getElementById('input-area').addEventListener('input', convert);

        // ÂàùÂßãÂåñËØ≠Ë®ÄÂíå‰∏ªÈ¢ò
        updateLanguage();
        updateThemeIcon();
    </script>
</body>
</html>